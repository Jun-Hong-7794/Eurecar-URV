/* Eurecar Scenario Script 
/* Made By Jun Hong 28.01.2017
/* This Script is for 2107 MBZIRC Challenge2

global_int gi_wrench_hanger_index = 3
/*gi_valve_size

# Title: Valve Recognition

## Step1: LRF-Kinova Vertical CTRL

LRF_KINOVA_VERTICAL_CTRL_STRUCT.desired_distance = 270
LRF_KINOVA_VERTICAL_CTRL_STRUCT.error = 2

LRF_KINOVA_VERTICAL_CTRL_STRUCT.s_deg = 30
LRF_KINOVA_VERTICAL_CTRL_STRUCT.e_deg = 150

LRF_KINOVA_VERTICAL_CTRL_STRUCT.inlier_lrf_dst = 800

LRF_KINOVA_VERTICAL_CTRL_STRUCT.loop_sleep = 30
LRF_KINOVA_VERTICAL_CTRL_STRUCT.sensor_option = false

LRF_KINOVA_VERTICAL_CTRL_FUNCTION()

A_Sleep(500)

## Step2: Vehicle Horizen Control(Using LRF)
/* unit is mm

LRF_VEHICLE_HORIZEN_CTRL_STRUCT.desired_avr_inlier_deg = 103
LRF_VEHICLE_HORIZEN_CTRL_STRUCT.error_deg_boundary = 3

LRF_VEHICLE_HORIZEN_CTRL_STRUCT.s_deg = 30
LRF_VEHICLE_HORIZEN_CTRL_STRUCT.e_deg = 150

LRF_VEHICLE_HORIZEN_CTRL_STRUCT.inlier_distance = 800


LRF_VEHICLE_HORIZEN_CTRL_STRUCT.velocity = 77

LRF_VEHICLE_HORIZEN_CTRL_STRUCT.sensor_option = false

LRF_VEHICLE_HORIZEN_CTRL_FUNCTION()

## Step0: Gripper Release

GRIPPER_FORCE_CTRL_STRUCT.pose_1 = 2500
GRIPPER_FORCE_CTRL_STRUCT.pose_2 = 2500
GRIPPER_FORCE_CTRL_STRUCT.forece_threshold = 200

GRIPPER_FORCE_CTRL_FUNCTION()

A_Sleep(1000)

## Step0: Kinova Arm Up

KINOVA_MANIPULATE_STRUCT.x = ==
KINOVA_MANIPULATE_STRUCT.y = ==
KINOVA_MANIPULATE_STRUCT.z = 0.4319

KINOVA_MANIPULATE_STRUCT.roll = ==
KINOVA_MANIPULATE_STRUCT.pitch = ==
KINOVA_MANIPULATE_STRUCT.yaw = ==

KINOVA_MANIPULATE_STRUCT.force_threshold = 10

KINOVA_MANIPULATE_FUNCTION()

A_Sleep(500)
## Step1: LRF-Kinova Vertical CTRL

LRF_KINOVA_VERTICAL_CTRL_STRUCT.desired_distance = 300
LRF_KINOVA_VERTICAL_CTRL_STRUCT.error = 2

LRF_KINOVA_VERTICAL_CTRL_STRUCT.s_deg = 30
LRF_KINOVA_VERTICAL_CTRL_STRUCT.e_deg = 150

LRF_KINOVA_VERTICAL_CTRL_STRUCT.inlier_lrf_dst = 800

LRF_KINOVA_VERTICAL_CTRL_STRUCT.loop_sleep = 30
LRF_KINOVA_VERTICAL_CTRL_STRUCT.sensor_option = false

LRF_KINOVA_VERTICAL_CTRL_FUNCTION()

A_Sleep(500)

## Step3: LRF-Kinova Horizen CTRL
LRF_KINOVA_HORIZEN_CTRL_STRUCT.desired_inlier_deg_avr = 107.5

LRF_KINOVA_HORIZEN_CTRL_STRUCT.error = 0.5

LRF_KINOVA_HORIZEN_CTRL_STRUCT.s_deg = 30 
LRF_KINOVA_HORIZEN_CTRL_STRUCT.e_deg = 150

LRF_KINOVA_HORIZEN_CTRL_STRUCT.inlier_lrf_dst = 800

LRF_KINOVA_HORIZEN_CTRL_STRUCT.loop_sleep = 30 LRF_KINOVA_HORIZEN_CTRL_STRUCT.sensor_option = false

LRF_KINOVA_HORIZEN_CTRL_FUNCTION()

A_Sleep(500)


## Step0: Kinova Arm Dw

KINOVA_MANIPULATE_STRUCT.x = ==
KINOVA_MANIPULATE_STRUCT.y = ==
KINOVA_MANIPULATE_STRUCT.z = 0.2438

KINOVA_MANIPULATE_STRUCT.roll = ==
KINOVA_MANIPULATE_STRUCT.pitch = ==
KINOVA_MANIPULATE_STRUCT.yaw = ==

KINOVA_MANIPULATE_STRUCT.force_threshold = 10

KINOVA_MANIPULATE_FUNCTION()

A_Sleep(500)


/*## Step3: Wrench Recognition

/*WRENCH_RECOGNITION_STRUCT.valve_size = gi_valve_size
/*WRENCH_RECOGNITION_STRUCT.valve_size = 16
/*gi_wrench_hanger_index = WRENCH_RECOGNITION_FUNCTION()

/*A_Sleep(500)

##########################################_MISSION_END_##########################################
